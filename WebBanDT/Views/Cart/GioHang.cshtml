@{
    ViewBag.Title = "Giỏ hàng";
    Layout = "~/Views/Shared/_CartLogin.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="@Url.Content("~/Content/stylecart.css")?v=@DateTime.UtcNow.Ticks" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
}
<div class="cart-page">
    <div class="cart-header-wrap">
        <div class="cart-header">
            <a class="back" href="@Url.Action("TrangChu","Home")">
                <i class="fa-solid fa-angle-left"></i>
                Mua thêm sản phẩm khác
            </a>
            <h1>Giỏ hàng của bạn</h1>
        </div>
    </div>

    <div class="wrap">
        <!-- CARD SẢN PHẨM -->
        <div class="card cart-item">
            <div class="item-col left">
                <label class="checkbox">
                    <input type="checkbox" checked>
                    <span></span>
                </label>

                <div class="thumb">
                    <img src="https://cdn2.cellphones.com.vn/358x/media/catalog/product/i/p/iphone-16-pro-max_1.png" alt="iPhone 16 Pro Max">
                </div>

                <div class="meta">
                    <div class="row-1">
                        <a class="name" href="#">iPhone 16 Pro Max 512GB | Chính hãng VN/A</a>
                        <button class="icon-btn" title="Xoá">
                            <i class="fa-regular fa-rectangle-xmark"></i>
                        </button>
                    </div>
                    <div class="sub">VN/A · Titan Sa Mạc</div>


                </div>
            </div>

            <div class="item-col right">
                <div class="price-box">
                    <div class="price-now" data-price="37990000">37.990.000₫</div>
                    <div class="price-old">41.990.000₫</div>
                </div>

                <div class="qty">
                    <button class="btn-qty" data-delta="-1">-</button>
                    <input id="qty" value="1" inputmode="numeric" />
                    <button class="btn-qty" data-delta="1">+</button>
                </div>
            </div>
        </div>
        <!-- Hết: chỉ còn card sản phẩm -->
    </div>
</div>

<!-- THANH TẠM TÍNH DÍNH ĐÁY -->
<div class="cart-sticky">
    <div class="inner">
        <div class="sum">
            <div>Tạm tính: <strong id="sumPrice">37.990.000₫</strong></div>
            <small>Tiết kiệm: 4.000.000₫</small>
        </div>
        <a class="btn-buy" href="@Url.Action("ThongTin","Cart")">Mua ngay <span id="cartCount">(1)</span></a>
    </div>
</div>

@section Scripts{
    <script>
        // tính lại tạm tính
        const qtyInput = document.getElementById('qty');
        const priceNow = document.querySelector('.price-now');
        const sumPrice = document.getElementById('sumPrice');
        const countSpan = document.getElementById('cartCount');

        function formatVND(n) { return (Number(n) || 0).toLocaleString('vi-VN') + '₫'; }
        function recalc() {
            const unit = Number(priceNow.dataset.price || 0);
            const q = Math.max(1, parseInt(qtyInput.value || '1', 10));
            qtyInput.value = q;
            sumPrice.textContent = formatVND(unit * q);
            countSpan.textContent = '(' + q + ')';
        }

        document.querySelectorAll('.btn-qty').forEach(btn => {
            btn.addEventListener('click', () => {
                qtyInput.value = Math.max(1, parseInt(qtyInput.value || '1', 10) + Number(btn.dataset.delta));
                recalc();
            });
        });
        qtyInput.addEventListener('input', recalc);
        recalc();
    </script>
}
